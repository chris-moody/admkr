/*!
 * VERSION: 0.1.2
 * DATE: 2018-03-03
 * UPDATES AND DOCS AT: https://chris-moody.github.io/mkr
 *
 * @license copyright 2017-2018 Christopher C. Moody
 *
 *  Permission is hereby granted, free of charge, to any person obtaining a copy of
 *  this software and associated documentation files (the "Software"), to deal in the
 *  Software without restriction, including without limitation the rights to use, copy,
 *  modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,
 *  and to permit persons to whom the Software is furnished to do so, subject to the
 *  following conditions:
 *
 *  The above copyright notice and this permission notice shall be included in all
 *  copies or substantial portions of the Software.
 *
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 *  INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 *  PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 *  HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 *  SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * @author: Christopher C. Moody, chris@moodydigital.com
 */
!function(global,className){var _instances={},_count=-1,drw=function(options){options=options||{},_count++;var id=this._id=options.id||"drw-"+_count;this._parent=mkr.setDefault(options,"parent",mkr.default(mkr.query("svg"),mkr.create("svg",{css:{overflow:"visible"}})));var p="string"==typeof this._parent?mkr.query(this._parent):this._parent;p instanceof SVGElement||(this._parent=mkr.query("svg",p)||mkr.create("svg",{css:{overflow:"visible"}},this._parent)),mkr.setDefault(options,"attr",{}),mkr.setDefault(options.attr,"id",id),mkr.setDefault(options,"css",{}),mkr.setDefault(options,"fill","transparent"),mkr.setDefault(options,"stroke","#000000"),mkr.setDefault(options,"strokeWidth",1),mkr.setDefault(options,"relative",!1),mkr.setDefault(options.attr,"d",""),mkr.setDefault(options.attr,"fill",options.fill),mkr.setDefault(options.attr,"stroke",options.stroke),mkr.setDefault(options.attr,"stroke-width",options.strokeWidth),this._path=mkr.create("path",{attr:options.attr,css:options.css},this._parent),this._x=mkr.default(options.x,0),this._y=mkr.default(options.y,0),this.move(this._x,this._y),this._startUnit=this._endUnit=!1,_instances[id]=this};drw.prototype={get el(){return this._path},get id(){return this.el.id},get parent(){return this.el.parentNode},get fill(){return this.el.getAttribute("fill")},set fill(value){this.el.setAttribute("fill",value)},get stroke(){return this.el.getAttribute("stroke")},set stroke(value){this.el.setAttribute("stroke",value)},get strokeWidth(){return this.el.getAttribute("stroke-width")},set strokeWidth(value){this.el.setAttribute("stroke-width",value)},get x(){return this._x},set x(value){this._x=value,this.setOrigin(this.x,this.y)},get y(){return this._y},set y(value){this._y=value,this.setOrigin(this.x,this.y)},get relative(){return this._relative},set relative(value){this._relative=value},get d(){return this.el.getAttribute("d")},set d(value){this.el.setAttribute("d",value)},get dasharray(){return window.getComputedStyle(this.el).getPropertyValue("stroke-dasharray")},set dasharray(value){TweenMax.set(this.el,{css:{strokeDasharray:value}})},get dashoffset(){return window.getComputedStyle(this.el).getPropertyValue("stroke-dashoffset")},set dashoffset(value){TweenMax.set(this.el,{css:{strokeDashoffset:value}})},get slice(){var offset,da,da0;if(offset=mkr.unitless(String(this.dashoffset).trim()),da=this.dasharray.split(","),da0=mkr.unitless(String(da[0]).trim()),0===offset&&isNaN(da0))return"0 100%";mkr.unitless(String(da[1]).trim());var start,end,len=this.el.getTotalLength();return offset<0?end=da0+(start=-offset):(start=0,end=Math.abs(da0-offset)),this._startUnit&&(start=100*mkr.fix(start/len)+"%"),this._endUnit&&(end=100*mkr.fix(end/len)+"%"),start+" "+end},set slice(value){var args=value.split(" ");if(0!=args.length){var start,end;1==args.length?(start=0,end=args[0]):(start=args[0],end=args[1]);var offset,da0,da1,p0,p1,len=this.el.getTotalLength();if("string"==typeof start){var n=start.indexOf("%");n>=0?(start=mkr.fix(len*(mkr.unitless(start)/100)),this._startUnit=!0):this._startUnit=!1}"string"==typeof end&&((n=end.indexOf("%"))>=0?(end=mkr.fix(len*(mkr.unitless(end)/100)),this._endUnit=!0):this._endUnit=!1),p0=Math.min(start,end),p1=Math.max(start,end),0==p0?(da0=len+1,offset=p1>=len?0:da0-p1):(da0=Math.abs(p1-p0),offset=-p0),da1=len+11,TweenMax.set(this,{dashoffset:offset,dasharray:da0+"px,"+da1+"px"})}},find:function(pattern){return drw.find(this.d,pattern)},split:function(path){return drw.split(this.d)},setRelative:function(value){return this.relative=value,this},setSlice:function(value){return this.slice=value,this},setOrigin:function(x,y){this.relative=value;var commands=this.split(),origin=commands.shift().split(" ");return["m","M"].indexOf(origin[0])>=0&&(origin[1]=x,origin[2]=y),commands.unshift(origin.join("")),this},insertRaw:function(index,cmd,params){var args=Array.prototype.slice.call(arguments,1),len=args.length;if(len>2)for(var arg,i=1;i<len;i++)"string"!=typeof(arg=args[i])&&(args[i]=arg=mkr.fix(arg),1!=i&&arg>=0&&(args[i]=","+arg));var c=args.join("").trim(),commands=""===this.d?[]:this.split();return(index=mkr.default(index,commands.length))<0&&(index=commands.length+index),commands.splice(index,0,c),TweenMax.set(this._path,{attr:{d:commands.join("")}}),this},insert:function(index,cmd,params){cmd=this.relative?cmd.toLowerCase():cmd.toUpperCase();var args=Array.prototype.slice.call(arguments);return this.insertRaw.apply(this,args)},addRaw:function(cmd,params){var args=Array.prototype.slice.call(arguments);return args.unshift(void 0),this.insertRaw.apply(this,args)},add:function(cmd,params){var args=Array.prototype.slice.call(arguments);return args.unshift(void 0),this.insert.apply(this,args)},clear:function(){return this.d="",this.move(this.x,this.y)},move:function(x,y){return this.add("M",x,y)},line:function(x,y){return this.add("L",x,y)},lineH:function(x){return this.add("H",x)},lineV:function(y){return this.add("V",y)},close:function(close){return this.add("Z")},curve:function(cx1,cy1,cx2,cy2,x,y){return this.add("C",cx1,cy1,cx2,cy2,x,y)},curve2:function(cx,cy,x,y){return this.add("S",cx,cy,x,y)},qdrtc:function(cx,cy,x,y){return this.add("Q",cx,cy,x,y)},qdrtc2:function(x,y){return this.add("T",x,y)},arc:function(x,y,r,start,length,fromCenter,largeArcSweepFlag,sweepFlag){var commands=drw.calculateArc(x,y,r,r,start,length,fromCenter,largeArcSweepFlag,sweepFlag);return this.add.apply(this,commands[0]),this.add.apply(this,commands[1])},arc2:function(x,y,rx,ry,start,length,fromCenter,largeArcSweepFlag,sweepFlag){var commands=drw.calculateArc(x,y,rx,ry,start,length,fromCenter,largeArcSweepFlag,sweepFlag);return this.add.apply(this,commands[0]),this.add.apply(this,commands[1])},circle:function(x,y,r,fromCenter){return this.arc(x,y,r,0,360,fromCenter)},ellipse:function(x,y,rx,ry,fromCenter){return this.arc2(x,y,rx,ry,0,360,fromCenter)},polygon:function(x,y,r,sides,rotation){sides=mkr.default(sides,5),rotation=mkr.default(rotation,0);var points=[],dR=mkr.RAD*(360/sides);rotation*=mkr.RAD,this.move(x,y);for(var dx,dy,lx=x,ly=y,i=0;i<sides;i++){lx+=dx=x+r*Math.cos(dR*i+rotation)-lx,ly+=dy=y+r*Math.sin(dR*i+rotation)-ly,points.push([lx,ly]);var func=0==i?this.move:this.line;this.relative?func.call(this,dx,dy):func.call(this,lx,ly)}return this.relative?(dx=points[0][0]-lx,dy=points[0][1]-ly,this.line(dx,dy)):this.line(points[0][0],points[0][1]),this},triangle:function(x,y,r,rotation){return this.polygon(x,y,r,3,rotation)},square:function(x,y,r,rotation){return this.polygon(x,y,r,4,rotation)},star:function(x,y,r1,r2,points,rotation){points=mkr.default(points,5),rotation=mkr.default(rotation,0);var coords=[],len=2*points,dR=mkr.RAD*(360/len);rotation*=mkr.RAD,this.move(x,y);for(var dx,dy,r,lx=x,ly=y,i=0;i<len;i++){lx+=dx=x+(r=i%2==0?r1:r2)*Math.cos(dR*i+rotation)-lx,ly+=dy=y+r*Math.sin(dR*i+rotation)-ly,coords.push([lx,ly]);var func=0==i?this.move:this.line;this.relative?func.call(this,dx,dy):func.call(this,lx,ly)}return this.relative?(dx=coords[0][0]-lx,dy=coords[0][1]-ly,this.line(dx,dy)):this.line(coords[0][0],coords[0][1]),this},rect:function(x,y,w,h){return this.move(x,y),this.relative?(this.lineH(w),this.lineV(h),this.lineH(-w),this.lineV(-h)):(this.lineH(x+w),this.lineV(y+h),this.lineH(x),this.lineV(y)),this}},drw.calculateArc=function(x,y,rx,ry,start,length,fromCenter,largeArcSweepFlag,sweepFlag){length%360==0&&0!=length&&(length+=length/Math.abs(length)*359.999);var x1,x2,y1,y2,rad1=(start+(length%=360)-90)*mkr.RAD,rad2=(start-90)*mkr.RAD;if(fromCenter=mkr.default(fromCenter,!0))x1=x+rx*Math.cos(rad1),y1=y+ry*Math.sin(rad1),x2=x+rx*Math.cos(rad2),y2=y+ry*Math.sin(rad2);else{x1=x,y1=y;var cx=x-rx*Math.cos(rad1),cy=y-ry*Math.sin(rad1);x2=cx+rx*Math.cos(rad2),y2=cy+ry*Math.sin(rad2)}return"auto"===(largeArcSweepFlag=mkr.default(largeArcSweepFlag,"auto"))&&(largeArcSweepFlag=length<=180?0:1),[["M",x1,y1],["A",rx,ry,0,largeArcSweepFlag,sweepFlag=mkr.default(sweepFlag,0),x2,y2]]},drw.find=function(path,pattern){pattern=pattern||"[A-Za-z]";var regX=new RegExp("("+pattern+")((( |-)?\\d+(\\.\\d+)*,*)*)","g"),results=[];return path.replace(regX,function(){var result={match:arguments[0],index:arguments[arguments.length-2],groups:Array.prototype.slice.call(arguments,1,-2)};results.push(result)}),results},drw.split=function(path){var matches=[];return path.replace(/([A-Za-z])((( |-)?\d+(\.\d+)*,*)*)/g,function(match){matches.push(match)}),matches},drw.getInstance=function(id){return _instances[id]},drw.getElInstance=function(el){return _instances[el.id]},Object.defineProperty(drw,"VERSION",{get:function(){return"0.1.2"}}),"function"==typeof define&&define.amd?define(function(){return drw}):"undefined"!=typeof module&&module.exports?module.exports=drw:global.drw=drw}(mkr._constructs);